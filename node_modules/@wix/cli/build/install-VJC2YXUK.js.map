{"version":3,"sources":["../../cli-site-old/src/install/index.ts","../../cli-site-old/src/install/install.ts"],"sourcesContent":["export { install } from './install.js';\n","import type { CommandServices } from '@wix/cli-command-contract';\nimport { createI18nT } from '../i18n.js';\nimport { createLogger } from '../logger.js';\nimport type { ProjectModel } from '../model.js';\nimport { authenticate } from '../authentication.js';\nimport {\n  resolvePackageManager,\n  resolveNpmDependencies,\n  migrateToAnyNpmIfNeeded,\n} from '../velo-npm/index.js';\n\nexport async function install(\n  model: ProjectModel,\n  { biLogger, errorReporter }: CommandServices,\n  options: {\n    yarn?: boolean;\n    npm?: boolean;\n  },\n  initialPackageName?: string\n) {\n  const authState = await authenticate({\n    metaSiteId: model.metaSiteId,\n    biLogger,\n    errorReporter,\n  });\n\n  const t = createI18nT();\n  const logger = createLogger({ t });\n  const packageName = initialPackageName?.trim() ?? null;\n\n  await migrateToAnyNpmIfNeeded(model.projectFolder, logger);\n\n  const logInstalled = packageName\n    ? logger.logDependencyInstalling(packageName)\n    : logger.logAllDependenciesInstalling();\n\n  try {\n    const packageManager = await resolvePackageManager(\n      model.projectFolder,\n      options\n    );\n\n    if (packageName) {\n      await packageManager.runInstallPackage(model.projectFolder, packageName);\n    } else {\n      await packageManager.runInstall(model.projectFolder);\n    }\n\n    await resolveNpmDependencies(model.projectFolder, { authState });\n\n    logInstalled.success();\n  } catch (error) {\n    logInstalled.fail();\n    throw error;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACAA;AAWA,eAAsB,QACpB,OACA,EAAE,UAAU,cAAc,GAC1B,SAIA,oBACA;AACA,QAAM,YAAY,MAAM,aAAa;AAAA,IACnC,YAAY,MAAM;AAAA,IAClB;AAAA,IACA;AAAA,EACF,CAAC;AAED,QAAM,IAAI,YAAY;AACtB,QAAM,SAAS,aAAa,EAAE,EAAE,CAAC;AACjC,QAAM,cAAc,oBAAoB,KAAK,KAAK;AAElD,QAAM,wBAAwB,MAAM,eAAe,MAAM;AAEzD,QAAM,eAAe,cACjB,OAAO,wBAAwB,WAAW,IAC1C,OAAO,6BAA6B;AAExC,MAAI;AACF,UAAM,iBAAiB,MAAM;AAAA,MAC3B,MAAM;AAAA,MACN;AAAA,IACF;AAEA,QAAI,aAAa;AACf,YAAM,eAAe,kBAAkB,MAAM,eAAe,WAAW;AAAA,IACzE,OAAO;AACL,YAAM,eAAe,WAAW,MAAM,aAAa;AAAA,IACrD;AAEA,UAAM,uBAAuB,MAAM,eAAe,EAAE,UAAU,CAAC;AAE/D,iBAAa,QAAQ;AAAA,EACvB,SAAS,OAAO;AACd,iBAAa,KAAK;AAClB,UAAM;AAAA,EACR;AACF;","names":[]}
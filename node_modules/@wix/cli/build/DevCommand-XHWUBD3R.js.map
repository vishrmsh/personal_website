{"version":3,"sources":["../../cli-site-live/src/components/DevCommand/DevCommand.tsx","../../cli-site-live/src/components/DevCommand/InitializingState.tsx","../../cli-site-live/src/velo-types-sync-client/useVeloTypesSyncClient.ts","../../cli-site-live/src/velo-types-sync-client/velo-types-sync-client.ts","../../cli-site-live/src/project-files-service/useProjectFilesService.ts","../../cli-site-live/src/project-files-service/project-files-service.ts","../../cli-site-live/src/components/DevCommand/ReadyState.tsx"],"sourcesContent":["import React from 'react';\nimport type { FC } from 'react';\nimport { InitializingState } from './InitializingState.js';\nimport { ReadyState } from './ReadyState.js';\n\nexport const DevCommand: FC = () => {\n  return (\n    <InitializingState>\n      <ReadyState />\n    </InitializingState>\n  );\n};\n","import type { FC, PropsWithChildren } from 'react';\nimport React from 'react';\nimport { match } from 'variant';\nimport { Spinner, useAsync } from '@wix/cli-ui-kit';\nimport { useTranslation } from '@wix/cli-i18n';\nimport { useVeloClient } from '@wix/velo-client';\nimport { useVeloTypesSyncClient } from '../../velo-types-sync-client/useVeloTypesSyncClient.js';\nimport { useProjectFilesService } from '../../project-files-service/useProjectFilesService.js';\nimport { useProjectModel } from '../../model.js';\n\nexport const InitializingState: FC<PropsWithChildren> = ({ children }) => {\n  const { t } = useTranslation();\n  const veloClient = useVeloClient();\n  const projectFilesService = useProjectFilesService();\n  const { veloAppId, projectFolder } = useProjectModel();\n  const veloTypeSyncer = useVeloTypesSyncClient(projectFolder);\n\n  const { status } = useAsync(async () => {\n    async function initProjectFiles() {\n      const { files, directories } = await veloClient.listAppFiles(veloAppId);\n      await Promise.all([\n        ...directories.map(projectFilesService.addDir),\n        ...files.map(projectFilesService.saveFile),\n      ]);\n    }\n    await Promise.all([initProjectFiles(), veloTypeSyncer.syncLatestTypes()]);\n  }, []);\n\n  return match(status, {\n    Success: () => children,\n    Error: () => null,\n    Loading: () => <Spinner text={t('dev_command.init.fetching_files')} />,\n  });\n};\n","import { useAuth } from '@wix/cli-auth';\nimport { useMemo } from 'react';\nimport { VeloTypesSyncClient } from './velo-types-sync-client.js';\n\nexport function useVeloTypesSyncClient(projectFolder: string) {\n  const { getAccessToken } = useAuth();\n\n  return useMemo(\n    () => new VeloTypesSyncClient(projectFolder, getAccessToken),\n    [projectFolder, getAccessToken]\n  );\n}\n","import pRetry from 'p-retry';\nimport type { Options } from 'p-retry';\nimport { syncLatestTypes } from '@wix/velo-site-types-syncer';\nimport { getTestOverrides } from '@wix/cli-test-overrides';\nimport { CliError, CliErrorCode } from '@wix/cli-error';\n\nexport class VeloTypesSyncClient {\n  private readonly retryOptions: Options;\n\n  constructor(\n    private projectFolder: string,\n    private getToken: () => Promise<string>\n  ) {\n    const { minRetryTimeout } = getTestOverrides();\n\n    this.retryOptions = {\n      retries: 3,\n      minTimeout: minRetryTimeout,\n      maxTimeout: 3 * 1000,\n    };\n  }\n\n  syncLatestTypes = async () => {\n    const token = await this.getToken();\n\n    try {\n      await pRetry(\n        () =>\n          syncLatestTypes(this.projectFolder, {\n            getAppToken: () => token,\n          }),\n        this.retryOptions\n      );\n    } catch (e) {\n      throw new CliError({\n        code: CliErrorCode.FailedToSyncPagesTypes(),\n        cause: e,\n      });\n    }\n  };\n}\n","import { useMemo } from 'react';\nimport { useProjectModel } from '../model.js';\nimport { ProjectFilesService } from './project-files-service.js';\n\nexport const useProjectFilesService = () => {\n  const { projectFolder } = useProjectModel();\n\n  return useMemo(() => new ProjectFilesService(projectFolder), [projectFolder]);\n};\n","import { join } from 'node:path';\nimport type { Directory, File } from '@wix/velo-client';\nimport { outputFile, outputDir } from '@wix/cli-fs';\n\nexport class ProjectFilesService {\n  constructor(private projectFolder: string) {}\n\n  addDir = async (file: Directory): Promise<void> => {\n    const filePath = this.getFullPath(file);\n    await outputDir(filePath);\n  };\n\n  saveFile = async (file: File): Promise<void> => {\n    const filePath = this.getFullPath(file);\n    await outputFile(filePath, file.content);\n  };\n\n  private getFullPath = (file: File | Directory) =>\n    join(this.projectFolder, file.path);\n}\n","import React from 'react';\nimport { Trans } from '@wix/cli-i18n';\n\nexport const ReadyState = () => {\n  return <Trans i18nKey=\"dev_command.welcome\" />;\n};\n"],"mappings":"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","names":["import_react","import_react","import_react","React","import_react","React","React"]}
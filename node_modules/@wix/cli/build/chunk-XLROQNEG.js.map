{"version":3,"sources":["../../cli-site-old/src/commands/run-command.ts"],"sourcesContent":["import { reportCommandStartEvent } from '@wix/cli-telemetry';\nimport type { Command } from '@commander-js/extra-typings';\nimport { cwd } from 'node:process';\nimport type { CommandServices } from '@wix/cli-command-contract';\nimport type { ProjectModel } from '../model.js';\nimport { loadProjectModel } from '../model.js';\n\nasync function initServices(\n  { metaSiteId }: ProjectModel,\n  { biLogger, errorReporter }: CommandServices\n) {\n  errorReporter.setContext('site info', {\n    siteId: metaSiteId,\n  });\n\n  biLogger.updateDefaults({\n    _msid: metaSiteId,\n  });\n}\n\nexport async function runCommand(\n  command: Command<unknown[]>,\n  services: CommandServices,\n  cliVersion: string,\n  commandFn: (model: ProjectModel) => Promise<void>\n) {\n  const model = await loadProjectModel(cwd());\n\n  await initServices(model, services);\n\n  const commandStatus = reportCommandStartEvent({\n    biLogger: services.biLogger,\n    command,\n    cliVersion,\n    flow: 'Sites',\n  });\n\n  try {\n    await commandFn(model);\n    commandStatus.succeed();\n  } catch (e) {\n    commandStatus.failed(e);\n    throw e;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;AAAA;AAEA,SAAS,WAAW;AAKpB,eAAe,aACb,EAAE,WAAW,GACb,EAAE,UAAU,cAAc,GAC1B;AACA,gBAAc,WAAW,aAAa;AAAA,IACpC,QAAQ;AAAA,EACV,CAAC;AAED,WAAS,eAAe;AAAA,IACtB,OAAO;AAAA,EACT,CAAC;AACH;AAEA,eAAsB,WACpB,SACA,UACA,YACA,WACA;AACA,QAAM,QAAQ,MAAM,iBAAiB,IAAI,CAAC;AAE1C,QAAM,aAAa,OAAO,QAAQ;AAElC,QAAM,gBAAgB,wBAAwB;AAAA,IAC5C,UAAU,SAAS;AAAA,IACnB;AAAA,IACA;AAAA,IACA,MAAM;AAAA,EACR,CAAC;AAED,MAAI;AACF,UAAM,UAAU,KAAK;AACrB,kBAAc,QAAQ;AAAA,EACxB,SAAS,GAAG;AACV,kBAAc,OAAO,CAAC;AACtB,UAAM;AAAA,EACR;AACF;","names":[]}
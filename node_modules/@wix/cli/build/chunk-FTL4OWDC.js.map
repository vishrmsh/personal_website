{"version":3,"sources":["../../cli-site-old/src/http-request.ts"],"sourcesContent":["import pRetry from 'p-retry';\nimport type { Options as RetryOptions } from 'p-retry';\nimport type {\n  HttpResponse,\n  RequestOptions,\n  RequestOptionsFactory,\n  CreateHttpClientOptions,\n} from '@wix/cli-http-client';\nimport type { AuthState } from '@wix/cli-auth';\nimport { CliError, CliErrorCode } from '@wix/cli-error';\nimport { createHttpClient, isHttpError } from '@wix/cli-http-client';\nimport { getTestOverrides } from '@wix/cli-test-overrides';\n\ntype Options = Pick<CreateHttpClientOptions, 'type'> & {\n  authState?: AuthState;\n};\n\nexport async function httpRequest<T>(\n  { type, authState }: Options,\n  requestOptions: RequestOptions<T> | RequestOptionsFactory<T>,\n  retryOptions?: RetryOptions\n): Promise<HttpResponse<T>> {\n  const { minRetryTimeout } = getTestOverrides();\n  const opts = {\n    type,\n    getAppToken: authState?.getAccessToken,\n    createHeaders: authState?.getRequestHeaders,\n  };\n\n  try {\n    const requestPromise = retryOptions\n      ? pRetry(() => createHttpClient(opts).request(requestOptions), {\n          ...retryOptions,\n          minTimeout: minRetryTimeout,\n        })\n      : createHttpClient(opts).request(requestOptions);\n\n    return await requestPromise;\n  } catch (e) {\n    if (isHttpError(e) && e.response?.status === 403) {\n      throw new CliError({\n        code: CliErrorCode.PermissionDenied(),\n        cause: e,\n      });\n    }\n    throw e;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAiBA,eAAsB,YACpB,EAAE,MAAM,UAAU,GAClB,gBACA,cAC0B;AAC1B,QAAM,EAAE,gBAAgB,IAAI,iBAAiB;AAC7C,QAAM,OAAO;AAAA,IACX;AAAA,IACA,aAAa,WAAW;AAAA,IACxB,eAAe,WAAW;AAAA,EAC5B;AAEA,MAAI;AACF,UAAM,iBAAiB,eACnB,OAAO,MAAM,iBAAiB,IAAI,EAAE,QAAQ,cAAc,GAAG;AAAA,MAC3D,GAAG;AAAA,MACH,YAAY;AAAA,IACd,CAAC,IACD,iBAAiB,IAAI,EAAE,QAAQ,cAAc;AAEjD,WAAO,MAAM;AAAA,EACf,SAAS,GAAG;AACV,QAAI,YAAY,CAAC,KAAK,EAAE,UAAU,WAAW,KAAK;AAChD,YAAM,IAAI,SAAS;AAAA,QACjB,MAAM,aAAa,iBAAiB;AAAA,QACpC,OAAO;AAAA,MACT,CAAC;AAAA,IACH;AACA,UAAM;AAAA,EACR;AACF;","names":[]}